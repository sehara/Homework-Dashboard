<!-- CACHE_BUST: 1767595215692 -->
<!-- CACHE_BUST: [1767594260825] -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Homework - UChicago MBA</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #800000 0%, #5a0000 100%);
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #800000 0%, #5a0000 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
            margin-bottom: 15px;
        }

        .update-button {
            background: white;
            color: #800000;
            border: none;
            padding: 12px 30px;
            font-size: 1.1em;
            font-weight: bold;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .update-button:hover {
            background: #f8f9fa;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .update-button:active {
            transform: translateY(0);
        }

        .summary-section {
            padding: 30px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }

        .summary-title {
            font-size: 1.8em;
            font-weight: bold;
            color: #800000;
            margin-bottom: 25px;
            text-align: center;
        }

        .course-cards {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 25px;
        }

        .course-card {
            background: white;
            border-radius: 15px;
            padding: 25px 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border-top: 6px solid #800000;
            text-align: center;
        }

        .course-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .course-card.low-workload {
            border-top-color: #28a745;
        }

        .course-card.medium-workload {
            border-top-color: #ffc107;
        }

        .course-card.high-workload {
            border-top-color: #dc3545;
        }

        .course-card.completed {
            border-top-color: #28a745;
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
        }

        .course-card-title {
            font-size: 1.1em;
            font-weight: bold;
            color: #800000;
            margin-bottom: 20px;
            min-height: 2.5em;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .course-card-hours {
            font-size: 3.5em;
            font-weight: bold;
            color: #800000;
            margin: 15px 0 5px 0;
            line-height: 1;
        }

        .course-card.low-workload .course-card-hours {
            color: #28a745;
        }

        .course-card.medium-workload .course-card-hours {
            color: #ffc107;
        }

        .course-card.high-workload .course-card-hours {
            color: #dc3545;
        }

        .course-card.completed .course-card-hours {
            font-size: 2.5em;
            color: #28a745;
        }

        .course-card-hours-label {
            font-size: 0.9em;
            color: #6c757d;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 20px;
        }
        .course-card-due {
            font-size: 0.85em;
            color: #dc3545;
            margin-top: 8px;
        }

        .course-card-status {
            font-size: 0.9em;
            padding: 6px 10px;
            border-radius: 4px;
            margin-top: 8px;
            font-weight: 500;
        }

        .course-card-status.under-control {
            background: #d4edda;
            color: #155724;
        }

        .course-card-status.needs-scheduling {
            background: #fff3cd;
            color: #856404;
        }

        .course-card-status.partial {
            background: #e7f3ff;
            color: #004085;
        }

        .course-card-due {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
            font-size: 0.85em;
            color: #dc3545;
            font-weight: 600;
            margin-top: 15px;
        }

        .pro-tip {
            background: white;
            padding: 20px;
            border-radius: 15px;
            border-left: 6px solid #28a745;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .pro-tip-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #28a745;
            margin-bottom: 10px;
        }

        .pro-tip-text {
            color: #495057;
            font-size: 1.05em;
        }

        .content {
            padding: 30px;
        }

        .day-section {
            margin-bottom: 30px;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            overflow: hidden;
        }

        .day-header {
            background: linear-gradient(135deg, #800000 0%, #5a0000 100%);
            color: white;
            padding: 20px;
            font-size: 1.5em;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            user-select: none;
        }

        .day-header:hover {
            opacity: 0.9;
        }

        .day-header .arrow {
            transition: transform 0.3s ease;
            opacity: 0.7;
            font-size: 0.9em;
        }

        .day-header.collapsed .arrow {
            transform: rotate(-90deg);
        }

        .day-content {
            max-height: 10000px;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .day-content.collapsed {
            max-height: 0;
        }

        .course-section {
            margin: 20px;
            border-left: 4px solid #800000;
            border-radius: 8px;
            overflow: hidden;
        }

        .course-header {
            background: #f8f9fa;
            padding: 15px 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            user-select: none;
        }

        .course-header:hover {
            background: #e9ecef;
        }

        .course-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #800000;
        }

        .course-due {
            color: #dc3545;
            font-weight: bold;
            font-size: 0.9em;
        }

        .course-arrow {
            transition: transform 0.3s ease;
            color: #adb5bd;
            font-size: 0.9em;
            opacity: 0.6;
        }

        .course-header.collapsed .course-arrow {
            transform: rotate(-90deg);
        }

        .course-content {
            max-height: 5000px;
            overflow: hidden;
            transition: max-height 0.3s ease;
            padding: 0 20px 20px 20px;
        }

        .course-content.collapsed {
            max-height: 0;
            padding: 0 20px;
        }

        .task-category {
            margin: 20px 0;
        }

        .category-title {
            font-size: 1.1em;
            font-weight: bold;
            color: #495057;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 15px;
            background: #e9ecef;
            border-radius: 8px;
            border-left: 4px solid #800000;
            cursor: pointer;
            user-select: none;
            transition: all 0.3s ease;
        }

        .category-title:hover {
            background: #dee2e6;
        }

        .category-title.grayed-out {
            background: #f8f9fa;
            opacity: 0.5;
            color: #adb5bd;
            border-left-color: #adb5bd;
        }

        .category-title-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .category-title-right {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .course-syllabus-link,
        .category-assignments-link {
            font-size: 0.9em;
            opacity: 0.6;
            margin-left: 8px;
            text-decoration: none;
            transition: all 0.2s ease;
            display: inline-block;
        }

        .course-syllabus-link:hover,
        .category-assignments-link:hover {
            opacity: 1;
            transform: scale(1.2);
        }

        .category-status {
            font-size: 1em;
            color: #28a745;
        }

        .category-controls {
            display: flex;
            gap: 5px;
        }

        .category-btn {
            background: #e9ecef;
            color: #adb5bd;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.75em;
            transition: all 0.2s;
            opacity: 0.3;
        }

        .category-btn:hover {
            background: #dee2e6;
            color: #6c757d;
            opacity: 1;
        }

        .category-btn.delete-btn {
            background: #f8d7da;
            color: #adb5bd;
            opacity: 0.4;
        }

        .category-btn.delete-btn:hover {
            background: #f5c6cb;
            color: #721c24;
            opacity: 1;
        }

        .category-arrow {
            transition: transform 0.3s ease;
            color: #ced4da;
            font-size: 0.75em;
            opacity: 0.5;
        }

        .category-title.collapsed .category-arrow {
            transform: rotate(-90deg);
        }

        .category-content {
            max-height: 3000px;
            overflow: hidden;
            transition: max-height 0.3s ease;
            margin-top: 15px;
        }

        .category-content.collapsed {
            max-height: 0;
            margin-top: 0;
        }

        .category-empty {
            color: #adb5bd;
            font-style: italic;
            padding: 12px;
            margin-left: 35px;
            background: #f8f9fa;
            border-radius: 5px;
        }

        .task-item {
            display: flex;
            align-items: flex-start;
            padding: 15px;
            margin: 10px 0 10px 35px;
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .task-item:hover {
            background: #f8f9fa;
            transform: translateX(5px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .task-item.completed {
            opacity: 0.35;
            background-color: #f8f9fa;
        }

        .task-item.scheduled {
            background-color: #e3f2fd;
            border-left: 3px solid #2196F3;
        }

        .task-item.completed:hover {
            transform: scale(0.98) translateX(5px);
            opacity: 0.5;
        }

        .task-checkbox {
            width: 24px;
            height: 24px;
            margin-right: 15px;
            cursor: pointer;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .task-details {
            flex: 1;
        }

        .task-title {
            font-weight: 500;
            margin-bottom: 5px;
        }argin-bottom: 8px;
            font-size: 1.05em;
        }

        .task-item.completed .task-title {
            text-decoration: line-through;
        }

        .task-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }

        .task-time {
            color: #6c757d;
            font-size: 0.95em;
        }

        .task-time-select {
            color: #6c757d;
            font-size: 0.9em;
            padding: 4px 8px;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            background: white;
            cursor: pointer;
            transition: border-color 0.2s;
        }

        .task-time-select:hover {
            border-color: #800000;
        }

        .task-time-select:focus {
            outline: none;
            border-color: #800000;
        }

        .task-points {
            color: #800000;
            font-size: 0.95em;
            font-weight: 600;
        }

        .task-link {
            color: #800000;
            text-decoration: none;
            font-size: 0.95em;
        }

        .task-link:hover {
            text-decoration: underline;
        }

        .task-calendar-link {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 4px 10px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            font-size: 0.85em;
            transition: all 0.2s;
            display: inline-block;
        }

        .task-calendar-link:hover {
            background: linear-gradient(135deg, #45a049, #3d8b40);
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .task-calendar-link.scheduled {
            background: linear-gradient(135deg, #2196F3, #1976D2);
        }

        .task-calendar-link.scheduled:hover {
            background: linear-gradient(135deg, #1976D2, #1565C0);
        }

        .task-notes-btn {
            background: #f8f9fa;
            color: #adb5bd;
            border: none;
            padding: 4px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.85em;
            transition: all 0.2s;
            opacity: 0.4;
        }

        .task-notes-btn:hover {
            background: #e9ecef;
            color: #6c757d;
            opacity: 1;
        }

        .task-notes-btn.has-notes {
            color: #ffc107;
            opacity: 0.8;
        }

        .task-notes-btn.has-notes:hover {
            color: #e0a800;
            opacity: 1;
        }

        .task-notes-area {
            margin-top: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
            border-left: 3px solid #800000;
        }

        .task-notes-textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            font-family: inherit;
            font-size: 0.9em;
            resize: none;
            overflow: hidden;
            box-sizing: border-box;
        }

        .task-notes-textarea:focus {
            outline: none;
            border-color: #800000;
        }

        .task-notes-save {
            margin-top: 8px;
            background: #800000;
            color: white;
            border: none;
            padding: 6px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.85em;
            transition: background 0.2s;
        }

        .task-notes-save:hover {
            background: #5a0000;
        }

        .task-controls {
            display: flex;
            flex-direction: column;
            gap: 5px;
            margin-left: 10px;
        }

        .task-btn {
            background: #e9ecef;
            color: #adb5bd;
            border: none;
            padding: 3px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.75em;
            transition: all 0.2s;
            opacity: 0.4;
        }

        .task-btn:hover {
            background: #e9ecef;
            color: #6c757d;
            opacity: 1;
        }

        .restore-section {
            margin: 20px 0;
            padding: 12px;
            background: #f8f9fa;
            border-left: 2px solid #e9ecef;
            border-radius: 8px;
            opacity: 0.4;
            transition: opacity 0.2s;
        }

        .restore-section:hover {
            opacity: 0.8;
        }

        .restore-title {
            font-weight: normal;
            color: #adb5bd;
            margin-bottom: 8px;
            font-size: 0.85em;
        }

        .restore-btn {
            background: #e9ecef;
            color: #6c757d;
            border: none;
            padding: 6px 12px;
            border-radius: 5px;
            cursor: pointer;
            margin: 3px;
            font-size: 0.8em;
            transition: all 0.2s;
        }

        .restore-btn:hover {
            background: #dee2e6;
            color: #495057;
        }

        @media (max-width: 1200px) {
            .course-cards {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .course-cards {
                grid-template-columns: 1fr;
            }

            .content {
                padding: 15px;
            }

            .day-header {
                font-size: 1.2em;
            }

            .course-title {
                font-size: 1.1em;
            }

            .task-item {
                margin-left: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ð Homework</h1>
            <p id="dateRange">UChicago MBA | Until Next Class</p>
            <button id="updateButton" class="update-button" onclick="updateHomework()">ð Update Homework</button>
        </div>

        <div class="summary-section">
            <div class="summary-title">â ï¸ Remaining Work This Week</div>
            
            <div class="course-cards" id="courseCards">
                <!-- Course cards dynamically generated -->
            </div>

            <div class="pro-tip">
                <div class="pro-tip-title">ð¡ Pro Tip</div>
                <div class="pro-tip-text">Start Corporate Governance readings today (Saturday) - spread 2-3 hours per day to avoid cramming Thursday night!</div>
            </div>
        </div>

        <div class="content" id="content">
            <!-- Tasks dynamically inserted -->
        </div>
    </div>

    <script>
        function formatTime(hours) {
            const totalMinutes = Math.round(hours * 60);
            const h = Math.floor(totalMinutes / 60);
            const m = totalMinutes % 60;
            
            if (h === 0) {
                return `${m} minutes`;
            } else if (m === 0) {
                return h === 1 ? '1 hour' : `${h} hours`;
            } else {
                const hourText = h === 1 ? '1 hour' : `${h} hours`;
                return `${hourText} ${m} minutes`;
            }
        }

        function getTaskTime(taskId, defaultTime) {
            return customTimeEstimates[taskId] || defaultTime;
        }

        async function updateTaskTime(taskId, newTime) {
            customTimeEstimates[taskId] = newTime;
            await window.storage.set('customTimeEstimates', JSON.stringify(customTimeEstimates));
            await renderTasks();
        }

        function generateTimeOptions() {
            const options = [];
            for (let i = 0.5; i <= 8; i += 0.5) {
                options.push(i);
            }
            return options;
        }

        function createGoogleCalendarLink(title, description, duration, taskId) {
            const baseUrl = 'https://calendar.google.com/calendar/u/0/r/eventedit';
            const text = encodeURIComponent(title);
            let fullDescription = description;
            if (taskNotes[taskId]) {
                fullDescription += `\n\nNotes:\n${taskNotes[taskId]}`;
            }
            const details = encodeURIComponent(fullDescription);
            
            // Round to next 30-minute block
            const now = new Date();
            const minutes = now.getMinutes();
            const roundedMinutes = minutes < 30 ? 30 : 60;
            const startTime = new Date(now);
            startTime.setMinutes(roundedMinutes, 0, 0);
            if (roundedMinutes === 60) {
                startTime.setHours(startTime.getHours() + 1);
                startTime.setMinutes(0, 0, 0);
            }
            
            const durationMs = duration * 60 * 60 * 1000; // duration in milliseconds
            const endTime = new Date(startTime.getTime() + durationMs);
            
            // Format: YYYYMMDDTHHmmss
            const formatDateTime = (date) => {
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                const hours = String(date.getHours()).padStart(2, '0');
                const minutes = String(date.getMinutes()).padStart(2, '0');
                const seconds = '00';
                return `${year}${month}${day}T${hours}${minutes}${seconds}`;
            };
            
            const dates = `${formatDateTime(startTime)}/${formatDateTime(endTime)}`;
            
            return `${baseUrl}?text=${text}&details=${details}&dates=${dates}`;
        }

        function saveTaskNote(taskId, note) {
            if (note.trim() === '') {
                delete taskNotes[taskId];
            } else {
                taskNotes[taskId] = note;
            }
            await window.storage.set('taskNotes', JSON.stringify(taskNotes));
            await renderTasks();
        }

        const courseData = {
        "Monday, January 5, 2026": {
                "PE VC Lab|||Due: Monday, Jan 5 at 11:59 PM": {
                        submit: [
                                {
                                        title: "Assignment 1: Submit Student Bio",
                                        time: 0.5,
                                        points: 0,
                                        link: "https://canvas.uchicago.edu/courses/65932/modules/items/2817542"
                                }
                        ],
                        reading: [
                                {
                                        title: "Week 0 - Inflection Points in VC.pdf",
                                        time: 1.0,
                                        points: null,
                                        link: "https://canvas.uchicago.edu/courses/65932/modules/items/2817538"
                                },
                                {
                                        title: "week zero video.mp4",
                                        time: 0.5,
                                        points: null,
                                        link: "https://canvas.uchicago.edu/courses/65932/modules/items/2817539"
                                },
                                {
                                        title: "Readings and Videos - Week 1",
                                        time: 1.5,
                                        points: null,
                                        link: "https://canvas.uchicago.edu/courses/65932/modules/items/2817541"
                                }
                        ],
                        required: [],
                        optional: [
                                {
                                        title: "Student bios, VC Section",
                                        time: 0.5,
                                        points: null,
                                        link: "https://canvas.uchicago.edu/courses/65932/modules/items/2817540"
                                }
                        ]
                }
        },
        "Tuesday, January 6, 2026": {
                "Managing in Organizations|||Due: Tuesday, Jan 6 at 8:30 AM": {
                        submit: [
                                {
                                        title: "First class assignment",
                                        time: 0.5,
                                        points: 0,
                                        link: "https://canvas.uchicago.edu/courses/67742/modules/items/2909560"
                                }
                        ],
                        reading: [
                                {
                                        title: "Thaler & Sunstein: Nudge, Introduction",
                                        time: 1.0,
                                        points: null,
                                        link: "https://canvas.uchicago.edu/courses/67742/modules/items/2909556"
                                },
                                {
                                        title: "Grant: Think again, Chapter 1",
                                        time: 1.0,
                                        points: null,
                                        link: "https://canvas.uchicago.edu/courses/67742/modules/items/2909557"
                                },
                                {
                                        title: "Golden careers: Money isn't everything",
                                        time: 0.5,
                                        points: null,
                                        link: "https://canvas.uchicago.edu/courses/67742/modules/items/2909558"
                                }
                        ],
                        required: [],
                        optional: [
                                {
                                        title: "Work from home or return to office?",
                                        time: 0.5,
                                        points: null,
                                        link: "https://canvas.uchicago.edu/courses/67742/modules/items/2909562"
                                }
                        ]
                },
                "Corporate Governance|||Due: Tuesday, Jan 6 at 6:00 PM": {
                        submit: [],
                        reading: [
                                {
                                        title: "01-CG2026 Agenda-EvolutionOfGovernance.docx",
                                        time: 0.5,
                                        points: null,
                                        link: "https://canvas.uchicago.edu/courses/69195/modules/items/2967457"
                                },
                                {
                                        title: "Week 1 - Combined Frameworks",
                                        time: 0.5,
                                        points: null,
                                        link: "https://canvas.uchicago.edu/courses/69195/modules/items/2957767"
                                },
                                {
                                        title: "Ray Corey at Norton",
                                        time: 1.0,
                                        points: null,
                                        link: "https://canvas.uchicago.edu/courses/69195/modules/items/2957770"
                                },
                                {
                                        title: "The Evolution of the Southwest Airlines Board",
                                        time: 1.0,
                                        points: null,
                                        link: "https://canvas.uchicago.edu/courses/69195/modules/items/2957771"
                                },
                                {
                                        title: "The Evolution of Corporate Governance in the United States",
                                        time: 0.5,
                                        points: null,
                                        link: "https://canvas.uchicago.edu/courses/69195/modules/items/2957773"
                                },
                                {
                                        title: "The Global History of Corporate Governance: An Introduction",
                                        time: 1.0,
                                        points: null,
                                        link: "http://proxy.uchicago.edu/login?url=http://site.ebrary.com/lib/uchicago/Doc?id=10209997"
                                },
                                {
                                        title: "The Ford Pinto Case",
                                        time: 1.0,
                                        points: null,
                                        link: "https://canvas.uchicago.edu/courses/69195/modules/items/2957777"
                                },
                                {
                                        title: "California Proposes Driverless-Car Rules",
                                        time: 0.5,
                                        points: null,
                                        link: "https://canvas.uchicago.edu/courses/69195/modules/items/2957778"
                                },
                                {
                                        title: "Congress Unites (Gasp) to Spread Self-Driving Cars Across America",
                                        time: 0.5,
                                        points: null,
                                        link: "https://canvas.uchicago.edu/courses/69195/modules/items/2957779"
                                },
                                {
                                        title: "The Surprising Ethics of Humans and Self",
                                        time: 0.5,
                                        points: null,
                                        link: "https://canvas.uchicago.edu/courses/69195/modules/items/2957780"
                                },
                                {
                                        title: "Travelers-Institute-Insuring-Autonomy-White-Paper.pdf",
                                        time: 1.0,
                                        points: null,
                                        link: "https://canvas.uchicago.edu/courses/69195/modules/items/2957781"
                                },
                                {
                                        title: "HBR Article: What Makes Great Boards Great",
                                        time: 0.5,
                                        points: null,
                                        link: "https://canvas.uchicago.edu/courses/69195/modules/items/2957783"
                                }
                        ],
                        required: [],
                        optional: []
                }
        },
        "Monday, January 12, 2026": {
                "PE VC Lab|||Due: Monday, Jan 12 at 11:59 PM": {
                        submit: [
                                {
                                        title: "Case 1: Andreessen-Horowitz",
                                        time: 2.0,
                                        points: 30,
                                        link: "https://canvas.uchicago.edu/courses/65932/modules/items/2817544"
                                }
                        ],
                        reading: [
                                {
                                        title: "Readings - Week 2",
                                        time: 1.5,
                                        points: null,
                                        link: "https://canvas.uchicago.edu/courses/65932/modules/items/2817543"
                                }
                        ],
                        required: [],
                        optional: []
                }
        },
        "Tuesday, January 13, 2026": {
                "Managing in Organizations|||Due: Tuesday, Jan 13 at 8:30 AM": {
                        submit: [
                                {
                                        title: "Thought paper 1 - Week 2",
                                        time: 1.5,
                                        points: 4,
                                        link: "https://canvas.uchicago.edu/courses/67742/modules/items/2909571"
                                }
                        ],
                        reading: [
                                {
                                        title: "Heath & Heath, Made to stick, Introduction & Chapters 1-5",
                                        time: 2.5,
                                        points: null,
                                        link: "https://canvas.uchicago.edu/courses/67742/modules"
                                }
                        ],
                        required: [],
                        optional: [
                                {
                                        title: "The importance of missing information",
                                        time: 0.5,
                                        points: null,
                                        link: "https://canvas.uchicago.edu/courses/67742/modules/items/2909575"
                                }
                        ]
                }
        },
        "Wednesday, January 14, 2026": {
                "Negotiation|||Due: Wednesday, Jan 14 at 11:59 PM": {
                        submit: [
                                {
                                        title: "Prep Sheet - New Recruit Negotiation",
                                        time: 1.0,
                                        points: 3,
                                        link: "https://canvas.uchicago.edu/courses/67439/modules/items/2979672"
                                }
                        ],
                        reading: [
                                {
                                        title: "What is Social Capital, and Why Should You Care.pdf",
                                        time: 0.5,
                                        points: null,
                                        link: "https://canvas.uchicago.edu/courses/67439/modules/items/2979467"
                                },
                                {
                                        title: "Granovetter - 1973 - The Strength of Weak Ties.pdf",
                                        time: 1.0,
                                        points: null,
                                        link: "https://canvas.uchicago.edu/courses/67439/modules/items/2979466"
                                },
                                {
                                        title: "HBR T-Shaped Managers.pdf",
                                        time: 0.5,
                                        points: null,
                                        link: "https://canvas.uchicago.edu/courses/67439/modules/items/2979474"
                                }
                        ],
                        required: [],
                        optional: []
                }
        }
};

        
const courseInfo = {
        "PE VC Lab": {
                due: "Monday, Jan 12 at 11:59 PM",
                syllabusUrl: "https://canvas.uchicago.edu/courses/65932/assignments/syllabus",
                assignmentsUrl: "https://canvas.uchicago.edu/courses/65932/assignments"
        },
        "Managing in Organizations": {
                due: "Tuesday, Jan 13 at 8:30 AM",
                syllabusUrl: "https://canvas.uchicago.edu/courses/67742/assignments/syllabus",
                assignmentsUrl: "https://canvas.uchicago.edu/courses/67742/assignments"
        },
        Negotiation: {
                due: "Wednesday, Jan 14 at 11:59 PM",
                syllabusUrl: "https://canvas.uchicago.edu/courses/67439/assignments/syllabus",
                assignmentsUrl: "https://canvas.uchicago.edu/courses/67439/assignments"
        },
        "Corporate Governance": {
                due: "Tuesday, Jan 6 at 6:00 PM",
                syllabusUrl: "https://canvas.uchicago.edu/courses/69195/assignments/syllabus",
                assignmentsUrl: "https://canvas.uchicago.edu/courses/69195/assignments"
        }
};


        
        let completedTaskIds = [];
        let scheduledTaskIds = [];
        let collapsedDays = [];
        let collapsedCourses = [];
        let customTimeEstimates = {};
        let taskNotes = {};
        let customTaskTitles = {};
        let collapsedCategories = [];
        let deletedCategories = [];
        let categoryOrder = {};
        let taskOrder = {};

        async function migrateLocalStorage() {
            const keys = [
                'completedTasks', 'scheduledTasks', 'collapsedDays', 'collapsedCourses',
                'customTimeEstimates', 'taskNotes', 'trackerVersion', 'customTaskTitles',
                'collapsedCategories', 'deletedCategories', 'categoryOrder', 'taskOrder'
            ];
            
            let migrated = false;
            for (const key of keys) {
                const localData = localStorage.getItem(key);
                if (localData !== null) {
                    const cloudData = await window.storage.get(key);
                    if (cloudData === null) {
                        await window.storage.set(key, localData);
                        migrated = true;
                    }
                }
            }
            if (migrated) console.log('Migration to cloud storage complete.');
        }

        async function initApp() {
            await migrateLocalStorage();
            
            completedTaskIds = JSON.parse(await window.storage.get('completedTasks')) || [];
            scheduledTaskIds = JSON.parse(await window.storage.get('scheduledTasks')) || [];
            collapsedDays = JSON.parse(await window.storage.get('collapsedDays')) || [];
            collapsedCourses = JSON.parse(await window.storage.get('collapsedCourses')) || [];
            customTimeEstimates = JSON.parse(await window.storage.get('customTimeEstimates')) || {};
            taskNotes = JSON.parse(await window.storage.get('taskNotes')) || {};

            const TRACKER_VERSION = 'reading-v1';
            const currentVersion = await window.storage.get('trackerVersion');
            
            if (!currentVersion || currentVersion !== TRACKER_VERSION) {
                // Clear old 'prepare' data if detected
                const oldKeys = ['completedTasks', 'scheduledTasks', 'collapsedDays', 'collapsedCourses'];
                for (const key of oldKeys) {
                    let data = JSON.parse(await window.storage.get(key)) || [];
                    if (Array.isArray(data)) {
                        const filtered = data.filter(id => !id.includes('|||prepare|||'));
                        await window.storage.set(key, JSON.stringify(filtered));
                    }
                }
                await window.storage.set('trackerVersion', TRACKER_VERSION);
            }
            
            customTaskTitles = JSON.parse(await window.storage.get('customTaskTitles')) || {};
            collapsedCategories = JSON.parse(await window.storage.get('collapsedCategories')) || [];
            deletedCategories = JSON.parse(await window.storage.get('deletedCategories')) || [];
            categoryOrder = JSON.parse(await window.storage.get('categoryOrder')) || {};
            taskOrder = JSON.parse(await window.storage.get('taskOrder')) || {};

            await renderTasks();
        }

        // Call initApp instead of renderTasks on load
        initApp();

        async function moveCategoryDown(day, courseKey, category) {
            const courseId = `${day}|||${courseKey}`;
            if (!categoryOrder[courseId]) {
                categoryOrder[courseId] = ['submit', 'reading', 'required', 'optional'];
            }
            const order = categoryOrder[courseId];
            const index = order.indexOf(category);
            if (index < order.length - 1) {
                [order[index], order[index + 1]] = [order[index + 1], order[index]];
                await window.storage.set('categoryOrder', JSON.stringify(categoryOrder));
                await renderTasks();
            }
        }

        async function deleteCategory(day, courseKey, category) {
            const categoryKey = getCategoryKey(day, courseKey, category);
            if (!deletedCategories.includes(categoryKey)) {
                deletedCategories.push(categoryKey);
                await window.storage.set('deletedCategories', JSON.stringify(deletedCategories));
                await renderTasks();
            }
        }

        async function restoreCategory(day, courseKey, category) {
            const categoryKey = getCategoryKey(day, courseKey, category);
            deletedCategories = deletedCategories.filter(c => c !== categoryKey);
            await window.storage.set('deletedCategories', JSON.stringify(deletedCategories));
            await renderTasks();
        }

        async function moveTaskUp(day, courseKey, category, itemIndex) {
            const taskKey = `${day}|||${courseKey}|||${category}`;
            if (!taskOrder[taskKey]) {
                const items = courseData[day][courseKey][category];
                taskOrder[taskKey] = items.map((_, i) => i);
            }
            const order = taskOrder[taskKey];
            const index = order.indexOf(itemIndex);
            if (index > 0) {
                [order[index], order[index - 1]] = [order[index - 1], order[index]];
                await window.storage.set('taskOrder', JSON.stringify(taskOrder));
                await renderTasks();
            }
        }

        async function moveTaskDown(day, courseKey, category, itemIndex) {
            const taskKey = `${day}|||${courseKey}|||${category}`;
            if (!taskOrder[taskKey]) {
                const items = courseData[day][courseKey][category];
                taskOrder[taskKey] = items.map((_, i) => i);
            }
            const order = taskOrder[taskKey];
            const index = order.indexOf(itemIndex);
            if (index < order.length - 1) {
                [order[index], order[index + 1]] = [order[index + 1], order[index]];
                await window.storage.set('taskOrder', JSON.stringify(taskOrder));
                await renderTasks();
            }
        }

        async function renderTasks() {
            const content = document.getElementById('content');
            content.innerHTML = '';

            // Filter data into active and archived
            const { active, archived } = filterAndOrganizeData();

            // Render active tasks
            Object.keys(active).forEach(day => {
                const daySection = document.createElement('div');
                daySection.className = 'day-section';

                const dayHeader = document.createElement('div');
                dayHeader.className = 'day-header';
                if (collapsedDays.includes(day)) {
                    dayHeader.classList.add('collapsed');
                }
                dayHeader.innerHTML = `<span>${day}</span><span class="arrow">â¼</span>`;
                dayHeader.addEventListener('click', () => await toggleDay(day));
                daySection.appendChild(dayHeader);

                const dayContent = document.createElement('div');
                dayContent.className = 'day-content';
                if (collapsedDays.includes(day)) {
                    dayContent.classList.add('collapsed');
                }

                Object.keys(active[day]).forEach(courseKey => {
                    const [courseName, due] = courseKey.split('|||');
                    const courseId = `${day}|||${courseKey}`;
                    const courseTaskData = active[day][courseKey];
                    
                    const courseSection = document.createElement('div');
                    courseSection.className = 'course-section';

                    const courseHeader = document.createElement('div');
                    courseHeader.className = 'course-header';
                    if (collapsedCourses.includes(courseId)) {
                        courseHeader.classList.add('collapsed');
                    }
                    const syllabusUrl = courseInfo[courseName] ? courseInfo[courseName].syllabusUrl : '';
                    courseHeader.innerHTML = `
                        <div>
                            <div class="course-title">
                                ${courseName}
                                ${syllabusUrl ? `<a href="${syllabusUrl}" target="_blank" class="course-syllabus-link" onclick="event.stopPropagation()" title="View Syllabus">ð</a>` : ''}
                            </div>
                            <div class="course-due">${due}</div>
                        </div>
                        <span class="course-arrow">â¼</span>
                    `;
                    courseHeader.addEventListener('click', () => await toggleCourse(courseId));
                    courseSection.appendChild(courseHeader);

                    const courseContent = document.createElement('div');
                    courseContent.className = 'course-content';
                    if (collapsedCourses.includes(courseId)) {
                        courseContent.classList.add('collapsed');
                    }

                    // Get category order
                    const defaultOrder = ['submit', 'reading', 'required', 'optional'];
                    const order = categoryOrder[courseId] || defaultOrder;

                    const categoryTitles = {
                        'submit': 'ð¯ SUBMIT (Actual Submission Required)',
                        'reading': 'ð READING (Required for Class)',
                        'required': 'ð REQUIRED READINGS',
                        'optional': 'ð¡ OPTIONAL READINGS'
                    };

                    const deletedInCourse = [];

                    order.forEach(category => {
                        const categoryId = `${courseId}|||${category}`;
                        const categoryKey = getCategoryKey(day, courseKey, category);
                        const items = courseTaskData[category];
                        
                        const isDeleted = deletedCategories.includes(categoryKey);
                        if (isDeleted) {
                            deletedInCourse.push({ category, title: categoryTitles[category] });
                            return;
                        }

                        const isEmpty = items.length === 0;
                        const allCompleted = items.length > 0 && items.every((item, itemIndex) => {
                            const taskId = getTaskKey(day, courseKey, category, itemIndex);
                            return completedTaskIds.includes(taskId);
                        });
                        const shouldGrayOut = isEmpty || allCompleted;
                        
                        const categoryDiv = document.createElement('div');
                        categoryDiv.className = 'task-category';

                        const categoryTitle = document.createElement('div');
                        categoryTitle.className = 'category-title';
                        if (collapsedCategories.includes(categoryId)) {
                            categoryTitle.classList.add('collapsed');
                        }
                        if (shouldGrayOut) {
                            categoryTitle.classList.add('grayed-out');
                        }
                        
                        const statusIcon = (allCompleted && !isEmpty) ? 'â ' : '';
                        
                        const leftDiv = document.createElement('div');
                        leftDiv.className = 'category-title-left';
                        const assignmentsUrl = courseInfo[courseName] ? courseInfo[courseName].assignmentsUrl : '';
                        const assignmentsLink = (category === 'submit' && assignmentsUrl) ? `<a href="${assignmentsUrl}" target="_blank" class="category-assignments-link" onclick="event.stopPropagation()" title="View Assignments">ð</a>` : '';
                        leftDiv.innerHTML = `
                            <span class="category-status">${statusIcon}</span>
                            <span>${categoryTitles[category]}</span>
                            ${assignmentsLink}
                        `;

                        const rightDiv = document.createElement('div');
                        rightDiv.className = 'category-title-right';
                        
                        const controls = document.createElement('div');
                        controls.className = 'category-controls';
                        
                        const upBtn = document.createElement('button');
                        upBtn.className = 'category-btn';
                        upBtn.textContent = 'â';
                        upBtn.onclick = (e) => {
                            e.stopPropagation();
                            await moveCategoryUp(day, courseKey, category);
                        };
                        
                        const downBtn = document.createElement('button');
                        downBtn.className = 'category-btn';
                        downBtn.textContent = 'â';
                        downBtn.onclick = (e) => {
                            e.stopPropagation();
                            await moveCategoryDown(day, courseKey, category);
                        };

                        controls.appendChild(upBtn);
                        controls.appendChild(downBtn);

                        if (shouldGrayOut) {
                            const deleteBtn = document.createElement('button');
                            deleteBtn.className = 'category-btn delete-btn';
                            deleteBtn.textContent = 'ðï¸';
                            deleteBtn.onclick = (e) => {
                                e.stopPropagation();
                                await deleteCategory(day, courseKey, category);
                            };
                            controls.appendChild(deleteBtn);
                        }

                        rightDiv.appendChild(controls);
                        
                        const arrow = document.createElement('span');
                        arrow.className = 'category-arrow';
                        arrow.textContent = 'â¼';
                        rightDiv.appendChild(arrow);

                        categoryTitle.appendChild(leftDiv);
                        categoryTitle.appendChild(rightDiv);
                        
                        categoryTitle.addEventListener('click', () => await toggleCategory(categoryId));
                        categoryDiv.appendChild(categoryTitle);

                        const categoryContent = document.createElement('div');
                        categoryContent.className = 'category-content';
                        if (collapsedCategories.includes(categoryId)) {
                            categoryContent.classList.add('collapsed');
                        }
                        
                        if (items.length === 0) {
                            const emptyDiv = document.createElement('div');
                            emptyDiv.className = 'category-empty';
                            emptyDiv.textContent = 'None';
                            categoryContent.appendChild(emptyDiv);
                        } else {
                            // Get task order
                            const taskKey = `${day}|||${courseKey}|||${category}`;
                            const defaultTaskOrder = items.map((_, i) => i);
                            const orderedIndices = taskOrder[taskKey] || defaultTaskOrder;

                            orderedIndices.forEach(itemIndex => {
                                const item = items[itemIndex];
                                const taskId = getTaskKey(day, courseKey, category, itemIndex);
                                const isCompleted = completedTaskIds.includes(taskId);
                                const isScheduled = scheduledTaskIds.includes(taskId);

                                const taskItem = document.createElement('div');
                                let taskClasses = 'task-item';
                                if (isCompleted) taskClasses += ' completed';
                                else if (isScheduled) taskClasses += ' scheduled';
                                taskItem.className = taskClasses;

                                const checkbox = document.createElement('input');
                                checkbox.type = 'checkbox';
                                checkbox.className = 'task-checkbox';
                                checkbox.checked = isCompleted;
                                checkbox.addEventListener('change', () => await toggleTask(taskId));

                                const details = document.createElement('div');
                                details.className = 'task-details';

                                // Title container with editable title and link icon
                                const titleContainer = document.createElement('div');
                                titleContainer.style.display = 'flex';
                                titleContainer.style.alignItems = 'center';
                                titleContainer.style.gap = '8px';
                                
                                const title = document.createElement('span');
                                title.className = 'task-title';
                                const customTitle = customTaskTitles[taskId] || item.title;
                                title.textContent = customTitle;
                                title.contentEditable = false;
                                title.style.cursor = 'text';
                                
                                // Double-click to edit
                                title.addEventListener('dblclick', () => {
                                    title.contentEditable = true;
                                    title.focus();
                                    // Select all text
                                    const range = document.createRange();
                                    range.selectNodeContents(title);
                                    const sel = window.getSelection();
                                    sel.removeAllRanges();
                                    sel.addRange(range);
                                });
                                
                                // Save on blur or Enter
                                title.addEventListener('blur', () => {
                                    title.contentEditable = false;
                                    const newTitle = title.textContent.trim();
                                    if (newTitle && newTitle !== item.title) {
                                        customTaskTitles[taskId] = newTitle;
                                        await window.storage.set('customTaskTitles', JSON.stringify(customTaskTitles));
                                    }
                                });
                                
                                title.addEventListener('keydown', (e) => {
                                    if (e.key === 'Enter') {
                                        e.preventDefault();
                                        title.blur();
                                    }
                                });
                                
                                // Link icon
                                const linkIcon = document.createElement('a');
                                linkIcon.href = item.link;
                                linkIcon.target = '_blank';
                                linkIcon.textContent = 'ð';
                                linkIcon.style.fontSize = '0.9em';
                                linkIcon.style.opacity = '0.5';
                                linkIcon.style.textDecoration = 'none';
                                linkIcon.style.transition = 'opacity 0.2s';
                                linkIcon.addEventListener('mouseenter', () => linkIcon.style.opacity = '1');
                                linkIcon.addEventListener('mouseleave', () => linkIcon.style.opacity = '0.5');
                                
                                titleContainer.appendChild(title);
                                titleContainer.appendChild(linkIcon);

                                const meta = document.createElement('div');
                                meta.className = 'task-meta';
                                
                                // Time dropdown
                                const currentTime = getTaskTime(taskId, item.time);
                                const timeSelect = document.createElement('select');
                                timeSelect.className = 'task-time-select';
                                const timeOptions = generateTimeOptions();
                                timeOptions.forEach(optTime => {
                                    const option = document.createElement('option');
                                    option.value = optTime;
                                    option.textContent = `â±ï¸ ${formatTime(optTime)}`;
                                    if (optTime === currentTime) {
                                        option.selected = true;
                                    }
                                    timeSelect.appendChild(option);
                                });
                                timeSelect.addEventListener('change', (e) => {
                                    await updateTaskTime(taskId, parseFloat(e.target.value));
                                });

                                if (item.points !== null) {
                                    const pointsSpan = document.createElement('span');
                                    pointsSpan.className = 'task-points';
                                    pointsSpan.textContent = `${item.points} pts`;
                                    meta.appendChild(pointsSpan);
                                }

                                // Calendar button with toggle
                                const calendarBtn = document.createElement('button');
                                calendarBtn.className = 'task-calendar-link';
                                if (isScheduled) {
                                    calendarBtn.classList.add('scheduled');
                                    calendarBtn.textContent = 'â Scheduled';
                                } else {
                                    calendarBtn.textContent = 'ð Add to Calendar';
                                }
                                calendarBtn.onclick = (e) => {
                                    e.preventDefault();
                                    e.stopPropagation();
                                    if (!isScheduled) {
                                        // First click: open Google Calendar
                                        const calDescription = `Canvas Link: ${item.link}`;
                                        const durationMinutes = Math.round(currentTime * 60);
                                        const calendarTitle = `(${durationMinutes}min) HW: ${courseName}: ${item.title}`;
                                        const calLink = createGoogleCalendarLink(calendarTitle, calDescription, currentTime, taskId);
                                        window.open(calLink, '_blank');
                                    }
                                    // Toggle scheduled state
                                    toggleScheduled(taskId);
                                };

                                // Notes button
                                const notesBtn = document.createElement('button');
                                notesBtn.className = 'task-notes-btn';
                                const hasNotes = taskNotes[taskId] && taskNotes[taskId].trim() !== '';
                                if (hasNotes) {
                                    notesBtn.classList.add('has-notes');
                                }
                                notesBtn.textContent = hasNotes ? 'ð Notes' : 'ð';
                                notesBtn.onclick = (e) => {
                                    e.stopPropagation();
                                    const notesArea = taskItem.querySelector('.task-notes-area');
                                    const textarea = notesArea.querySelector('.task-notes-textarea');
                                    if (notesArea.style.display === 'none' || !notesArea.style.display) {
                                        notesArea.style.display = 'block';
                                        // Trigger auto-expand when opening
                                        setTimeout(() => {
                                            textarea.style.height = 'auto';
                                            textarea.style.height = Math.max(80, textarea.scrollHeight) + 'px';
                                        }, 0);
                                    } else {
                                        notesArea.style.display = 'none';
                                    }
                                };

                                // Reorder: Points â Time â Notes â Calendar
                                meta.appendChild(timeSelect);
                                meta.appendChild(notesBtn);
                                meta.appendChild(calendarBtn);

                                details.appendChild(titleContainer);
                                details.appendChild(meta);

                                // Notes area (hidden by default)
                                const notesArea = document.createElement('div');
                                notesArea.className = 'task-notes-area';
                                notesArea.style.display = 'none';

                                const notesTextarea = document.createElement('textarea');
                                notesTextarea.className = 'task-notes-textarea';
                                notesTextarea.placeholder = 'Add notes for this task...';
                                notesTextarea.value = taskNotes[taskId] || '';
                                
                                // Auto-expand textarea to fit content
                                const autoExpand = () => {
                                    notesTextarea.style.height = 'auto';
                                    notesTextarea.style.height = Math.max(80, notesTextarea.scrollHeight) + 'px';
                                };
                                notesTextarea.addEventListener('input', autoExpand);
                                // Expand on load if there's existing content
                                setTimeout(autoExpand, 0);

                                const notesSaveBtn = document.createElement('button');
                                notesSaveBtn.className = 'task-notes-save';
                                notesSaveBtn.textContent = 'Save Notes';
                                notesSaveBtn.onclick = (e) => {
                                    e.stopPropagation();
                                    saveTaskNote(taskId, notesTextarea.value);
                                    notesArea.style.display = 'none';
                                };

                                notesArea.appendChild(notesTextarea);
                                notesArea.appendChild(notesSaveBtn);
                                details.appendChild(notesArea);

                                const taskControls = document.createElement('div');
                                taskControls.className = 'task-controls';

                                const taskUpBtn = document.createElement('button');
                                taskUpBtn.className = 'task-btn';
                                taskUpBtn.textContent = 'â';
                                taskUpBtn.onclick = (e) => {
                                    e.stopPropagation();
                                    await moveTaskUp(day, courseKey, category, itemIndex);
                                };

                                const taskDownBtn = document.createElement('button');
                                taskDownBtn.className = 'task-btn';
                                taskDownBtn.textContent = 'â';
                                taskDownBtn.onclick = (e) => {
                                    e.stopPropagation();
                                    await moveTaskDown(day, courseKey, category, itemIndex);
                                };

                                taskControls.appendChild(taskUpBtn);
                                taskControls.appendChild(taskDownBtn);

                                taskItem.appendChild(checkbox);
                                taskItem.appendChild(details);
                                taskItem.appendChild(taskControls);

                                categoryContent.appendChild(taskItem);
                            });
                        }

                        categoryDiv.appendChild(categoryContent);
                        courseContent.appendChild(categoryDiv);
                    });

                    // Restore section
                    if (deletedInCourse.length > 0) {
                        const restoreSection = document.createElement('div');
                        restoreSection.className = 'restore-section';
                        
                        const restoreTitle = document.createElement('div');
                        restoreTitle.className = 'restore-title';
                        restoreTitle.textContent = 'ð Deleted Sections (Click to Restore)';
                        restoreSection.appendChild(restoreTitle);

                        deletedInCourse.forEach(({ category, title }) => {
                            const restoreBtn = document.createElement('button');
                            restoreBtn.className = 'restore-btn';
                            restoreBtn.textContent = title;
                            restoreBtn.onclick = () => await restoreCategory(day, courseKey, category);
                            restoreSection.appendChild(restoreBtn);
                        });

                        courseContent.appendChild(restoreSection);
                    }

                    courseSection.appendChild(courseContent);
                    dayContent.appendChild(courseSection);
                });

                daySection.appendChild(dayContent);
                content.appendChild(daySection);
            });

            // Render archived tasks
            if (Object.keys(archived).length > 0) {
                const archiveSection = document.createElement('div');
                archiveSection.className = 'day-section';
                archiveSection.style.marginTop = '40px';

                const archiveHeader = document.createElement('div');
                archiveHeader.className = 'day-header';
                archiveHeader.style.background = 'linear-gradient(135deg, #6c757d 0%, #495057 100%)';
                const archiveCollapsed = collapsedDays.includes('__archive__');
                if (archiveCollapsed) {
                    archiveHeader.classList.add('collapsed');
                }
                archiveHeader.innerHTML = `<span>ð¦ Archived Tasks (Past Due)</span><span class="arrow">â¼</span>`;
                archiveHeader.addEventListener('click', () => await toggleDay('__archive__'));
                archiveSection.appendChild(archiveHeader);

                const archiveContent = document.createElement('div');
                archiveContent.className = 'day-content';
                if (archiveCollapsed) {
                    archiveContent.classList.add('collapsed');
                }

                // Render archived data (similar structure to active)
                Object.keys(archived).forEach(day => {
                    Object.keys(archived[day]).forEach(courseKey => {
                        const [courseName, due] = courseKey.split('|||');
                        const courseId = `${day}|||${courseKey}`;
                        const courseTaskData = archived[day][courseKey];
                        
                        const courseSection = document.createElement('div');
                        courseSection.className = 'course-section';
                        courseSection.style.opacity = '0.6';

                        const courseHeader = document.createElement('div');
                        courseHeader.className = 'course-header';
                        courseHeader.innerHTML = `
                            <div>
                                <div class="course-title">${courseName} - ${day}</div>
                            </div>
                        `;

                        courseSection.appendChild(courseHeader);
                        archiveContent.appendChild(courseSection);
                    });
                });

                archiveSection.appendChild(archiveContent);
                content.appendChild(archiveSection);
            }

            renderCourseCards();
        }

        async function toggleDay(day) {
            if (collapsedDays.includes(day)) {
                collapsedDays = collapsedDays.filter(d => d !== day);
            } else {
                collapsedDays.push(day);
            }
            await window.storage.set('collapsedDays', JSON.stringify(collapsedDays));
            await renderTasks();
        }

        async function toggleCourse(courseId) {
            if (collapsedCourses.includes(courseId)) {
                collapsedCourses = collapsedCourses.filter(c => c !== courseId);
            } else {
                collapsedCourses.push(courseId);
            }
            await window.storage.set('collapsedCourses', JSON.stringify(collapsedCourses));
            await renderTasks();
        }

        async function toggleCategory(categoryId) {
            if (collapsedCategories.includes(categoryId)) {
                collapsedCategories = collapsedCategories.filter(c => c !== categoryId);
            } else {
                collapsedCategories.push(categoryId);
            }
            await window.storage.set('collapsedCategories', JSON.stringify(collapsedCategories));
            await renderTasks();
        }

        async function toggleTask(taskId) {
            const index = completedTaskIds.indexOf(taskId);
            if (index > -1) {
                completedTaskIds.splice(index, 1);
            } else {
                completedTaskIds.push(taskId);
            }
            await window.storage.set('completedTasks', JSON.stringify(completedTaskIds));
            await renderTasks();
        }

        function toggleScheduled(taskId) {
            const index = scheduledTaskIds.indexOf(taskId);
            if (index > -1) {
                scheduledTaskIds.splice(index, 1);
            } else {
                scheduledTaskIds.push(taskId);
            }
            await window.storage.set('scheduledTasks', JSON.stringify(scheduledTaskIds));
            await renderTasks();
        }

        function startUpdateCountdown() {
            // Create countdown banner
            const banner = document.createElement('div');
            banner.id = 'updateBanner';
            banner.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #800000 0%, #5a0000 100%);
                color: white;
                padding: 20px 30px;
                border-radius: 15px;
                box-shadow: 0 8px 25px rgba(0,0,0,0.3);
                z-index: 9999;
                font-size: 1.1em;
                font-weight: bold;
                min-width: 300px;
            `;
            
            let secondsLeft = 120; // 2 minutes
            
            const updateBannerText = () => {
                const minutes = Math.floor(secondsLeft / 60);
                const seconds = secondsLeft % 60;
                banner.innerHTML = `
                    <div style="margin-bottom: 10px;">â³ Updating homework...</div>
                    <div style="font-size: 2em; text-align: center;">${minutes}:${seconds.toString().padStart(2, '0')}</div>
                    <div style="font-size: 0.8em; opacity: 0.8; margin-top: 10px; text-align: center;">Auto-refresh in progress</div>
                `;
            };
            
            updateBannerText();
            document.body.appendChild(banner);
            
            const countdownInterval = setInterval(() => {
                secondsLeft--;
                updateBannerText();
                
                if (secondsLeft <= 0) {
                    clearInterval(countdownInterval);
                    banner.innerHTML = '<div>ð Refreshing...</div>';
                    
                    // Refresh the page
                    setTimeout(() => {
                        // Show notification
                        if (Notification.permission === 'granted') {
                            new Notification('ð Homework Updated!', {
                                body: 'Your tracker has been refreshed with new assignments.',
                                icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">ð</text></svg>'
                            });
                        }
                        location.reload();
                    }, 500);
                }
            }, 1000);
            
            // Add cancel button
            const cancelBtn = document.createElement('button');
            cancelBtn.textContent = 'â Cancel';
            cancelBtn.style.cssText = `
                background: white;
                color: #800000;
                border: none;
                padding: 8px 20px;
                border-radius: 8px;
                cursor: pointer;
                font-weight: bold;
                margin-top: 15px;
                width: 100%;
            `;
            cancelBtn.onclick = () => {
                clearInterval(countdownInterval);
                banner.remove();
            };
            banner.appendChild(cancelBtn);
        }

        function updateHomework() {
            // Show modal with instructions
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            `;
            
            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                background: white;
                padding: 40px;
                border-radius: 20px;
                max-width: 700px;
                max-height: 80vh;
                overflow-y: auto;
            `;
            
            const instructions = `
Update my homework tracker with new Canvas data.

**I've attached my current homework_tracker_updated.html file.**

Courses to scrape:
1. Managing in Organizations: https://canvas.uchicago.edu/courses/67742/modules
2. PE VC Lab: https://canvas.uchicago.edu/courses/65932/modules
3. Negotiation: https://canvas.uchicago.edu/courses/67439/modules
4. Corporate Governance: https://canvas.uchicago.edu/courses/69195/modules

For each course:
- Extract ALL homework items (readings, assignments, submissions) for the next 2 weeks
- Include readings even if there's no assignment due
- Categorize as: submit, reading, required, or optional
- If it's listed under Canvas Assignments, put it in "submit" even if 0 points
- Estimate time needed (in hours, use 0.5 hour increments)
- Get the Canvas link for each item
- Use exact Canvas due dates and times

Format the data like this:
{
  "Monday, January 5, 2026": {
    "PE VC Lab|||Due: Monday, Jan 5 at 11:59 PM": {
      submit: [{title: "...", time: 0.5, points: null, link: "..."}],
      reading: [{title: "...", time: 1.0, points: null, link: "..."}],
      required: [],
      optional: []
    }
  }
}

IMPORTANT FORMATTING:
- Use JavaScript object notation (no quotes around keys like submit, reading)
- Use "points: null" for readings (not 0)
- Day of week must be correct (check calendar)
- Course names: "PE VC Lab", "Managing in Organizations", "Negotiation", "Corporate Governance"

Then:
1. Read the attached homework_tracker_updated.html file
2. Find the courseData object (search for "const courseData")
3. Replace ONLY the courseData object with new scraped data
4. Find the courseInfo object (search for "const courseInfo")
5. Update courseInfo with correct first due dates for each course
6. Keep everything else exactly the same (all JavaScript, CSS, HTML)
7. Save as: homework_tracker_updated.html
8. Give me the download link

CRITICAL:
- Use "reading" NOT "prepare" in categories
- Update BOTH courseData AND courseInfo
- Verify all 4 courses appear in courseInfo with correct due dates
- Include dates with only readings (no submissions)
- The file I attached has all the working code - don't change anything except courseData and courseInfo
            `.trim();
            
            modalContent.innerHTML = `
                <h2 style="color: #800000; margin-bottom: 20px;">ð Update Homework</h2>
                <div style="background: #fff3cd; border: 2px solid #ffc107; border-radius: 10px; padding: 15px; margin-bottom: 20px;">
                    <p style="margin: 0; font-weight: bold; color: #856404;">ð IMPORTANT: When you paste into Manus, attach your current <code>homework_tracker_updated.html</code> file!</p>
                </div>
                <p style="margin-bottom: 20px; font-size: 1.1em;">Copy these instructions and paste them in a new Manus chat:</p>
                <textarea readonly id="instructionsText" style="
                    width: 100%;
                    height: 400px;
                    padding: 15px;
                    font-family: monospace;
                    font-size: 0.9em;
                    border: 2px solid #dee2e6;
                    border-radius: 8px;
                    margin-bottom: 20px;
                    resize: vertical;
                ">${instructions}</textarea>
                <div style="display: flex; gap: 15px; justify-content: flex-end;">
                    <button onclick="this.parentElement.parentElement.parentElement.remove()" style="
                        background: #6c757d;
                        color: white;
                        border: none;
                        padding: 12px 30px;
                        font-size: 1em;
                        font-weight: bold;
                        border-radius: 8px;
                        cursor: pointer;
                    ">Close</button>
                    <button id="copyButton" onclick="
                        const textarea = document.getElementById('instructionsText');
                        
                        textarea.select();
                        document.execCommand('copy');
                        this.textContent = '\u2705 Copied!';
                        
                        setTimeout(() => this.textContent = '\ud83d\udccb Copy & Open Manus', 2000);
                        window.open('https://manus.im', '_blank');
                        
                        // Request notification permission
                        if (Notification.permission === 'default') {
                            Notification.requestPermission();
                        }
                        
                        // Close modal and start countdown
                        setTimeout(() => {
                            this.parentElement.parentElement.parentElement.remove();
                            startUpdateCountdown();
                        }, 2000);
                    " style="
                        background: #800000;
                        color: white;
                        border: none;
                        padding: 12px 30px;
                        font-size: 1em;
                        font-weight: bold;
                        border-radius: 8px;
                        cursor: pointer;
                    ">ð Copy & Open Manus</button>
                </div>
            `;
            
            modal.appendChild(modalContent);
            document.body.appendChild(modal);
            
            // Close on background click
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // Initialize
        await renderTasks();
    </script>
</body>
</html>
